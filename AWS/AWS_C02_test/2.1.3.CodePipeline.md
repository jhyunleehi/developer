AWS DVA-C02 시험에서 CodePipeline은 CI/CD 파이프라인을 자동화하는 중요한 도구입니다. 시험에서 CodePipeline에 관련된 예상 질문과 그에 대한 답변을 정리했습니다.

### 1. CodePipeline의 기본 구성 요소는 무엇인가요?
답변:
CodePipeline은 소스, 빌드, 배포 단계로 구성된 CI/CD 파이프라인을 자동화합니다. 주요 구성 요소는 다음과 같습니다:

* Source (소스): 소스 코드를 저장하는 위치. CodeCommit, S3, GitHub, Bitbucket 등에서 소스 코드를 가져옵니다.
* Build (빌드): 소스 코드를 빌드하고 테스트하는 단계. CodeBuild 또는 다른 빌드 도구를 사용합니다.
* Deploy (배포): 빌드된 애플리케이션을 배포하는 단계. CodeDeploy, Elastic Beanstalk, ECS 등을 사용해 애플리케이션을 배포합니다.
* Actions (작업): 파이프라인의 각 단계에서 수행되는 작업을 정의합니다.
* Stages (단계): 파이프라인의 단계(예: 빌드, 테스트, 배포)를 나타냅니다.

### 2. CodePipeline에서 Source 단계에 사용할 수 있는 소스 리포지토리는 무엇인가요?
답변:
CodePipeline의 소스 단계에서 사용할 수 있는 소스 리포지토리는 다음과 같습니다:

* AWS CodeCommit: AWS에서 제공하는 Git 호스팅 서비스.
* Amazon S3: S3 버킷에 저장된 소스 코드 파일.
* GitHub: GitHub 리포지토리에서 소스 코드 가져오기.
* GitHub Enterprise: GitHub Enterprise에서 소스 코드 가져오기.
* Bitbucket: Bitbucket 리포지토리에서 소스 코드 가져오기.

### 3. CodePipeline에서 빌드를 자동화하기 위해 사용할 수 있는 서비스는 무엇인가요?
답변:
* CodePipeline에서 빌드 단계는 AWS CodeBuild나 Jenkins, TeamCity, GitLab CI와 같은 서드파티 빌드 도구를 사용할 수 있습니다.

* AWS CodeBuild는 서버리스 빌드 서비스로, 서버를 관리할 필요 없이 소스 코드를 빌드하고 테스트합니다.

### 4. CodePipeline에서 수동 승인 단계를 사용하는 이유는 무엇인가요?
답변:
**수동 승인 단계(Manual Approval)**는 배포 전에 사람이 개입해 특정 조건을 확인하거나 수동으로 검토한 후 승인을 수행하는 절차입니다. 이를 통해 자동화된 파이프라인의 중요한 단계에서 인간의 검토가 필요할 때 제어할 수 있습니다. 예를 들어, 프로덕션 환경에 배포하기 전에 코드 검토나 사용자 테스트가 완료되었는지 확인하는 경우가 있습니다.

### 5. CodePipeline에서 배포할 수 있는 대상은 무엇인가요?
답변:
CodePipeline에서 배포할 수 있는 대상은 다음과 같습니다:

* AWS CodeDeploy: EC2 인스턴스, 온프레미스 서버, 또는 Lambda 함수에 배포.
* AWS Elastic Beanstalk: Elastic Beanstalk 환경으로 배포.
* Amazon ECS: 컨테이너 기반 애플리케이션을 Amazon Elastic Container Service로 배포.
* S3: 정적 웹사이트 파일을 S3 버킷에 배포.
* CloudFormation: 인프라를 코드로 정의하여 AWS 리소스를 배포.

### 6. CodePipeline에서 아티팩트란 무엇인가요?
답변:
**아티팩트(Artifacts)**는 파이프라인의 각 단계에서 생성된 결과물입니다. 예를 들어, 빌드 단계에서는 소스 코드를 컴파일하고 패키지화한 파일이 아티팩트로 생성될 수 있습니다. 이 아티팩트는 S3 버킷에 저장되며, 이후 단계(예: 배포 단계)에서 사용할 수 있습니다.

### 7. CodePipeline에서 병렬 실행을 설정할 수 있나요?
답변:
네, CodePipeline에서 병렬 실행을 설정할 수 있습니다. 파이프라인 단계 내에서 병렬로 여러 작업을 수행하도록 정의할 수 있습니다. 예를 들어, 여러 환경(스테이징, 프로덕션)에서 병렬로 테스트를 실행하거나 여러 빌드 작업을 동시에 처리할 수 있습니다. 이를 위해 단계 내 여러 액션을 설정하여 병렬 실행이 가능합니다.

### 8. CodePipeline이 새 커밋 또는 소스 코드 변경 사항을 어떻게 감지하나요?
답변:
CodePipeline은 Amazon CloudWatch Events 또는 Amazon EventBridge와 연동하여 소스 코드 저장소에 새로운 커밋이나 변경 사항이 발생할 때 트리거됩니다. 소스 단계에 정의된 리포지토리에서 변경 사항이 감지되면 자동으로 파이프라인이 시작되어 빌드 및 배포가 진행됩니다.

### 9. CodePipeline에서 실패한 작업을 재시도할 수 있나요?
답변:
네, CodePipeline에서는 실패한 작업을 수동으로 재시도할 수 있습니다. 파이프라인 실행 중 특정 단계에서 작업이 실패하면 해당 단계에서 작업을 다시 실행하도록 설정할 수 있습니다. 또한, 파이프라인이 중단된 상태에서 이후 작업을 다시 시작할 수 있습니다.

### 10. CodePipeline의 비용은 어떻게 산정되나요?
답변:
CodePipeline의 비용은 파이프라인 실행 횟수에 따라 산정됩니다. AWS에서는 매월 첫 1,000회의 파이프라인 실행이 무료로 제공됩니다. 그 이후에는 실행당 비용이 청구됩니다. 추가적인 서비스(예: CodeBuild, CodeDeploy, S3 등) 사용 시 해당 서비스의 비용이 별도로 부과됩니다.



AWS CodePipeline을 사용한 지속적 통합 및 지속적 배포(CI/CD) 파이프라인 예시는 다음과 같은 요소들로 구성됩니다:

1. 소스 스테이지: 소스 코드가 저장되는 리포지토리 (예: GitHub 또는 AWS CodeCommit).
2. 빌드 스테이지: AWS CodeBuild를 사용해 소스 코드를 빌드.
3. 배포 스테이지: AWS Lambda, EC2, S3 등에 배포.

이 예시에서는 CodePipeline을 사용해 AWS Lambda 함수를 지속적으로 통합하고 배포하는 파이프라인을 설정합니다.

CodePipeline CI/CD 파이프라인 예시:

```yaml
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  # S3 버킷 (빌드 아티팩트를 저장할 곳)
  ArtifactS3Bucket:
    Type: 'AWS::S3::Bucket'

  # CodeCommit 리포지토리 (소스 코드 저장소)
  CodeCommitRepository:
    Type: 'AWS::CodeCommit::Repository'
    Properties:
      RepositoryName: MyLambdaRepo
      RepositoryDescription: "Repository for Lambda function source code"

  # CodeBuild 프로젝트 (코드를 빌드하는 역할)
  CodeBuildProject:
    Type: 'AWS::CodeBuild::Project'
    Properties:
      Name: MyLambdaBuildProject
      Source:
        Type: CODECOMMIT
        Location: !GetAtt CodeCommitRepository.CloneUrlHttp
      Artifacts:
        Type: S3
        Location: !Ref ArtifactS3Bucket
      Environment:
        ComputeType: BUILD_GENERAL1_SMALL
        Image: aws/codebuild/standard:5.0
        Type: LINUX_CONTAINER
      ServiceRole: !GetAtt CodeBuildServiceRole.Arn

  # IAM 역할 (CodeBuild에 필요한 권한 부여)
  CodeBuildServiceRole:
    Type: 'AWS::IAM::Role'
    Properties:
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
            Action: sts:AssumeRole
      Policies:
        - PolicyName: CodeBuildPolicy
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Action:
                  - s3:GetObject
                  - s3:PutObject
                Resource: arn:aws:s3:::*

  # Lambda 함수 (배포 대상)
  MyLambdaFunction:
    Type: 'AWS::Lambda::Function'
    Properties:
      FunctionName: MyLambdaFunction
      Handler: index.handler
      Runtime: nodejs14.x
      Role: !GetAtt LambdaExecutionRole.Arn
      Code:
        S3Bucket: !Ref ArtifactS3Bucket
        S3Key: latest.zip
      MemorySize: 128
      Timeout: 30

  # Lambda 실행에 필요한 IAM 역할
  LambdaExecutionRole:
    Type: 'AWS::IAM::Role'
    Properties:
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
            Action: sts:AssumeRole
      Policies:
        - PolicyName: LambdaExecutionPolicy
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Resource: arn:aws:logs:*:*:*

  # CodePipeline 파이프라인
  CodePipeline:
    Type: 'AWS::CodePipeline::Pipeline'
    Properties:
      Name: MyLambdaCICDPipeline
      RoleArn: !GetAtt CodePipelineServiceRole.Arn
      ArtifactStore:
        Type: S3
        Location: !Ref ArtifactS3Bucket
      Stages:
        - Name: Source
          Actions:
            - Name: SourceAction
              ActionTypeId:
                Category: Source
                Owner: AWS
                Provider: CodeCommit
                Version: 1
              OutputArtifacts:
                - Name: SourceArtifact
              Configuration:
                RepositoryName: !Ref CodeCommitRepository
                BranchName: master
              RunOrder: 1
        - Name: Build
          Actions:
            - Name: BuildAction
              ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: 1
              InputArtifacts:
                - Name: SourceArtifact
              OutputArtifacts:
                - Name: BuildArtifact
              Configuration:
                ProjectName: !Ref CodeBuildProject
              RunOrder: 1
        - Name: Deploy
          Actions:
            - Name: DeployAction
              ActionTypeId:
                Category: Deploy
                Owner: AWS
                Provider: Lambda
                Version: 1
              InputArtifacts:
                - Name: BuildArtifact
              Configuration:
                FunctionName: !Ref MyLambdaFunction
              RunOrder: 1

  # CodePipeline에 필요한 역할
  CodePipelineServiceRole:
    Type: 'AWS::IAM::Role'
    Properties:
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              Service: codepipeline.amazonaws.com
            Action: sts:AssumeRole
      Policies:
        - PolicyName: CodePipelinePolicy
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Action:
                  - s3:GetObject
                  - s3:PutObject
                  - codebuild:StartBuild
                  - codebuild:BatchGetBuilds
                  - lambda:UpdateFunctionCode
                Resource: "*"

Outputs:
  PipelineName:
    Value: !Ref CodePipeline
    Description: "Name of the CodePipeline"
```    

### 구성 요소 설명:
1. S3 버킷 (ArtifactS3Bucket):

빌드 아티팩트(즉, 빌드된 코드)를 저장할 S3 버킷입니다.

2. CodeCommit 리포지토리 (CodeCommitRepository):

소스 코드가 저장되는 AWS CodeCommit 리포지토리입니다.

3. CodeBuild 프로젝트 (CodeBuildProject):

소스 코드를 빌드하는 CodeBuild 프로젝트입니다. CodeCommit에서 소스를 가져와 빌드하고 S3 버킷에 빌드 결과를 저장합니다.

4. Lambda 함수 (MyLambdaFunction):

CodePipeline을 통해 배포할 AWS Lambda 함수입니다. 이 함수는 S3에서 제공되는 최신 빌드 파일(latest.zip)을 사용하여 업데이트됩니다.

5. IAM 역할:

CodeBuildServiceRole과 CodePipelineServiceRole은 각각 CodeBuild와 CodePipeline이 필요한 작업을 수행할 수 있도록 권한을 부여합니다.

6. CodePipeline 파이프라인 (CodePipeline):

이 파이프라인은 세 가지 스테이지로 구성되어 있습니다:
* Source: CodeCommit 리포지토리에서 소스 코드를 가져옵니다.
* Build: CodeBuild 프로젝트에서 코드를 빌드하고 아티팩트를 생성합니다.
* Deploy: 빌드된 코드를 Lambda 함수로 배포합니다.

7. Outputs:

생성된 CodePipeline의 이름을 출력합니다.
이 템플릿으로 할 수 있는 작업:
* 지속적 통합(CI): 개발자가 CodeCommit에 코드를 푸시하면, CodePipeline이 소스 코드를 가져와 CodeBuild에서 자동으로 빌드합니다.
* 지속적 배포(CD): 빌드가 완료되면, CodePipeline은 자동으로 Lambda 함수에 새 코드를 배포합니다.

이 구조는 Lambda 함수를 배포하는 CI/CD 파이프라인의 기본적인 예이며, 다른 AWS 서비스를 활용해 CI/CD를 구현할 수 있습니다.